import{c as M,D as Z,E as T,a as I,h as y,d as x,g as L,aE as g,a0 as u,a1 as O,a2 as t,a5 as l,a3 as o,a4 as c,aa as Q,an as V,am as E,J as v,a6 as m,ao as p,ap as U,aF as q,aG as R,aH as A,a9 as S,a7 as f,aI as D,aJ as z,a8 as h,ac as J,ad as G}from"./index.d436ad73.js";import{Q as P}from"./QSpace.067289dd.js";import{Q as b}from"./QInput.0f6ca6f6.js";import{Q as w,a as F}from"./QSelect.917dcf46.js";import{Q as N}from"./QForm.9c595543.js";import{Q as H}from"./QBadge.efffaa81.js";import{Q as j}from"./QTooltip.25e2e452.js";import{Q as K}from"./QPage.b58eb39f.js";import{C}from"./ClosePopup.66a9a7e9.js";import{_ as W}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-key-composition.002912ea.js";import"./use-file-dom-props.89b0fc0b.js";import"./format.19399105.js";import"./selection.dbfae057.js";var X=M({name:"QBanner",props:{...Z,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(a,{slots:r}){const{proxy:{$q:d}}=L(),_=T(a,d),s=I(()=>"q-banner row items-center"+(a.dense===!0?" q-banner--dense":"")+(_.value===!0?" q-banner--dark q-dark":"")+(a.rounded===!0?" rounded-borders":"")),i=I(()=>`q-banner__actions row items-center justify-end col-${a.inlineActions===!0?"auto":"all"}`);return()=>{const e=[y("div",{class:"q-banner__avatar col-auto row items-center self-start"},x(r.avatar)),y("div",{class:"q-banner__content col text-body2"},x(r.default))],n=x(r.action);return n!==void 0&&e.push(y("div",{class:i.value},n)),y("div",{class:s.value+(a.inlineActions===!1&&n!==void 0?" q-banner--top-padding":""),role:"alert"},e)}}});const Y={data(){return{zona:"",zonaEditar:"",nombreCompleto:"",usuario:"",contrase\u00F1a:"",email:"",usuarios:[],nombreCompletoEditar:"",usuarioEditar:"",rolEditar:"",rol:"",contrase\u00F1aEditar:"",emailEditar:"",usuarioEditandoId:null,confirmarEliminarDialog:!1,usuarioAEliminarId:null,rolesDisponibles:["administrador","Comercial 1","Comercial 2","Contable","Supervisor","Asesor"],coloresRoles:{administrador:"deep-purple","Comercial 1":"teal","Comercial 2":"green",Contable:"blue",Supervisor:"orange",Asesor:"red"},iconosRoles:{administrador:"admin_panel_settings","Comercial 1":"sell","Comercial 2":"add_business",Contable:"account_balance",Supervisor:"supervisor_account",Asesor:"support_agent"},mostrarModalAgregar:!1,mostrarModalEditar:!1}},computed:{formValido(){return this.nombreCompleto&&this.usuario&&this.contrase\u00F1a&&this.rol&&(this.rol!=="Asesor"||this.rol==="Asesor"&&this.zona)&&this.email},formValidoEditar(){return this.nombreCompletoEditar&&this.usuarioEditar&&this.contrase\u00F1aEditar&&this.rolEditar&&(this.rolEditar!=="Asesor"||this.rolEditar==="Asesor"&&this.zonaEditar)&&this.emailEditar}},mounted(){this.cargarUsuarios()},methods:{obtenerColorRol(a){return this.coloresRoles[a]||"grey"},obtenerIconoRol(a){return this.iconosRoles[a]||"person"},filtrarUsuariosPorRol(a){return this.usuarios.filter(r=>r.rol===a)},getInitials(a){return a?a.split(" ").map(r=>r.charAt(0)).join("").toUpperCase().substring(0,2):"?"},confirmarEliminar(a){this.usuarioAEliminarId=a,this.confirmarEliminarDialog=!0},eliminarUsuarioConfirmado(){this.eliminarUsuario(this.usuarioAEliminarId),this.usuarioAEliminarId=null},checkZonaFieldEditar(){this.rolEditar!=="Asesor"&&(this.zonaEditar="")},checkZonaField(){this.rol!=="Asesor"&&(this.zona="")},cargarUsuarios(){fetch("https://backmultidestinos.onrender.com/user/").then(a=>{if(!a.ok)throw new Error("Error en la respuesta del servidor: "+a.status);return a.json()}).then(a=>{this.usuarios=a}).catch(a=>{console.error("Error al cargar usuarios:",a),g.create({type:"negative",message:"Error al cargar usuarios: "+a.message,position:"top",timeout:2500})})},submitForm(){const a="1",r={nombreCompleto:this.nombreCompleto,usuario:this.usuario,contrasena:this.contrase\u00F1a,activo:a,rol:this.rol,zona:this.zona?this.zona:"",email:this.email};fetch("https://backmultidestinos.onrender.com/user/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(d=>{if(!d.ok)throw new Error("Error en la respuesta del servidor: "+d.status);return d.json()}).then(d=>{console.log("Usuario agregado:",d),g.create({type:"positive",message:"Usuario agregado correctamente",position:"top",icon:"check_circle",timeout:2500}),this.cargarUsuarios(),this.limpiarFormulario(),this.mostrarModalAgregar=!1}).catch(d=>{console.error("Error al enviar datos:",d),g.create({type:"negative",message:"Error al agregar usuario: "+d.message,position:"top",timeout:2500})})},editarUsuario(a){this.nombreCompletoEditar=a.nombreCompleto,this.usuarioEditar=a.usuario,this.rolEditar=a.rol,this.usuarioEditandoId=a.id,this.zonaEditar=a.zona||"",this.contrase\u00F1aEditar="",this.emailEditar=a.email||"",this.usuarioOriginal={...a},this.mostrarModalEditar=!0},editarUsuarioSubmit(){if(!this.formValidoEditar){g.create({type:"warning",message:"Complete todos los campos requeridos",position:"top",timeout:2500});return}const a={id:this.usuarioEditandoId,nombreCompleto:this.nombreCompletoEditar,usuario:this.usuarioEditar,rol:this.rolEditar,zona:this.zonaEditar||"",email:this.emailEditar,activo:"1",imagenPerfil:this.usuarioOriginal.imagenPerfil};this.contrase\u00F1aEditar&&this.contrase\u00F1aEditar.trim()!==""&&(a.contrasena=this.contrase\u00F1aEditar),console.log("Usuario a actualizar:",a),console.log("imagenPerfil preservado:",this.usuarioOriginal.imagenPerfil),fetch(`https://backmultidestinos.onrender.com/user/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(async r=>{if(console.log("Status de respuesta:",r.status),!r.ok){let d=`Error ${r.status}`;try{const _=await r.text();console.log("Respuesta del servidor:",_),_&&(d+=`: ${_}`)}catch{console.log("No se pudo leer el mensaje de error del servidor")}throw new Error(d)}return r.json()}).then(r=>{console.log("Usuario editado:",r),this.cargarUsuarios(),this.limpiarFormularioEditar(),this.mostrarModalEditar=!1,g.create({type:"positive",message:"Usuario editado correctamente",icon:"check_circle",position:"top",timeout:2500})}).catch(r=>{console.error("Error al editar usuario:",r),g.create({type:"negative",message:"Error al editar usuario: "+r.message,position:"top",timeout:2500})})},eliminarUsuario(a){fetch(`https://backmultidestinos.onrender.com/user/${a}`,{method:"DELETE"}).then(r=>{if(!r.ok)throw new Error("Error en la respuesta del servidor: "+r.status);this.usuarios=this.usuarios.filter(d=>d.id!==a),console.log("Usuario eliminado con ID:",a),g.create({type:"positive",message:"Usuario eliminado correctamente",icon:"check_circle",position:"top",timeout:2500})}).catch(r=>{console.error("Error al eliminar usuario:",r),g.create({type:"negative",message:"Error al eliminar usuario: "+r.message,position:"top",timeout:2500})})},limpiarFormulario(){this.nombreCompleto="",this.usuario="",this.contrase\u00F1a="",this.rol="",this.zona="",this.email=""},limpiarFormularioEditar(){this.nombreCompletoEditar="",this.usuarioEditar="",this.contrase\u00F1aEditar="",this.rolEditar="",this.zonaEditar="",this.emailEditar="",this.usuarioEditandoId=null}}},k=a=>(J("data-v-486c48a3"),a=a(),G(),a),$={class:"container-wrapper q-pa-md"},ee={class:"header-container q-mb-lg"},oe={class:"row items-center justify-between full-width"},re=k(()=>l("h4",{class:"q-ma-none text-weight-bold text-primary"}," Gesti\xF3n de Usuarios ",-1)),ae=k(()=>l("div",{class:"text-h6"},"Agregar Nuevo Usuario",-1)),te={class:"row q-col-gutter-md"},se={class:"col-12"},le={class:"col-12 col-md-6"},ie={class:"col-12 col-md-6"},ne={class:"col-12 col-md-6"},de={key:0,class:"col-12 col-md-6"},me={class:"col-12 col-md-6"},ue={class:"row justify-end q-mt-lg"},ce=k(()=>l("div",{class:"text-h6"},"Editar Usuario",-1)),pe={class:"row q-col-gutter-md"},he={class:"col-12"},ge={class:"col-12 col-md-6"},fe={class:"col-12 col-md-6"},be={class:"col-12 col-md-6"},_e={key:0,class:"col-12 col-md-6"},Ee={class:"col-12 col-md-6"},ve={class:"row justify-end q-mt-lg"},Ce={class:"roles-container"},ye={class:"row items-center q-py-sm q-px-md"},Ve={class:"row q-col-gutter-md q-mt-md q-pa-sm"},Ue=["src"],we={class:"text-h6 q-mt-sm"},ke={class:"text-subtitle2 text-grey-8"},xe={class:"text-subtitle2 text-grey-8"},qe={key:0,class:"q-mt-sm"},Ae={key:0,class:"col-12"},ze=k(()=>l("span",{class:"q-ml-sm text-h6"},"Confirmar eliminaci\xF3n",-1));function Ie(a,r,d,_,s,i){return u(),O(K,{class:"custom-page-bg"},{default:t(()=>[l("div",$,[l("div",ee,[l("div",oe,[re,o(c,{onClick:r[0]||(r[0]=e=>s.mostrarModalAgregar=!0),label:"Agregar Usuario",class:"add-button",icon:"person_add",color:"primary",unelevated:"",rounded:""})]),o(Q,{class:"q-mt-sm",color:"blue-grey-2"})]),o(q,{modelValue:s.mostrarModalAgregar,"onUpdate:modelValue":r[7]||(r[7]=e=>s.mostrarModalAgregar=e),persistent:"","content-css":"max-width: 500px;"},{default:t(()=>[o(V,{class:"modal-card"},{default:t(()=>[o(E,{class:"row items-center bg-primary text-white"},{default:t(()=>[ae,o(P),v(o(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[C]])]),_:1}),o(E,{class:"q-pa-md"},{default:t(()=>[o(N,{onSubmit:i.submitForm},{default:t(()=>[l("div",te,[l("div",se,[o(b,{label:"Nombre completo",modelValue:s.nombreCompleto,"onUpdate:modelValue":r[1]||(r[1]=e=>s.nombreCompleto=e),rules:[e=>!!e||"El nombre completo es obligatorio"],filled:""},{prepend:t(()=>[o(m,{name:"person"})]),_:1},8,["modelValue","rules"])]),l("div",le,[o(b,{label:"Usuario",modelValue:s.usuario,"onUpdate:modelValue":r[2]||(r[2]=e=>s.usuario=e),rules:[e=>!!e||"El usuario es obligatorio"],filled:""},{prepend:t(()=>[o(m,{name:"account_circle"})]),_:1},8,["modelValue","rules"])]),l("div",ie,[o(b,{label:"Contrase\xF1a",modelValue:s.contrase\u00F1a,"onUpdate:modelValue":r[3]||(r[3]=e=>s.contrase\u00F1a=e),type:"password",rules:[e=>!!e||"La contrase\xF1a es obligatoria"],filled:""},{prepend:t(()=>[o(m,{name:"vpn_key"})]),_:1},8,["modelValue","rules"])]),l("div",ne,[o(w,{label:"Rol",modelValue:s.rol,"onUpdate:modelValue":r[4]||(r[4]=e=>s.rol=e),options:s.rolesDisponibles,rules:[e=>!!e||"El rol es obligatorio"],onInput:i.checkZonaField,filled:""},{prepend:t(()=>[o(m,{name:"assignment_ind"})]),_:1},8,["modelValue","options","rules","onInput"])]),s.rol==="Asesor"?(u(),p("div",de,[o(w,{label:"Zona",modelValue:s.zona,"onUpdate:modelValue":r[5]||(r[5]=e=>s.zona=e),options:["Zona 1","Zona 2"],rules:[e=>!!e||"La zona es obligatoria"],filled:""},{prepend:t(()=>[o(m,{name:"place"})]),_:1},8,["modelValue","rules"])])):U("",!0),l("div",me,[o(b,{label:"Correo",modelValue:s.email,"onUpdate:modelValue":r[6]||(r[6]=e=>s.email=e),rules:[e=>!!e||"El correo es obligatorio"],filled:""},{prepend:t(()=>[o(m,{name:"email"})]),_:1},8,["modelValue","rules"])])]),l("div",ue,[v(o(c,{outline:"",label:"Cancelar",color:"negative",class:"q-mr-sm"},null,512),[[C]]),o(c,{type:"submit",label:"Registrar Usuario",color:"primary",disable:!i.formValido,unelevated:""},null,8,["disable"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(q,{modelValue:s.mostrarModalEditar,"onUpdate:modelValue":r[14]||(r[14]=e=>s.mostrarModalEditar=e),persistent:"","content-css":"max-width: 600px;"},{default:t(()=>[o(V,{class:"modal-card"},{default:t(()=>[o(E,{class:"row items-center bg-primary text-white"},{default:t(()=>[ce,o(P),v(o(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[C]])]),_:1}),o(E,{class:"q-pa-md"},{default:t(()=>[o(N,{onSubmit:i.editarUsuarioSubmit},{default:t(()=>[l("div",pe,[l("div",he,[o(b,{label:"Nombre completo",modelValue:s.nombreCompletoEditar,"onUpdate:modelValue":r[8]||(r[8]=e=>s.nombreCompletoEditar=e),rules:[e=>!!e||"El nombre completo es obligatorio"],filled:""},{prepend:t(()=>[o(m,{name:"person"})]),_:1},8,["modelValue","rules"])]),l("div",ge,[o(b,{label:"Usuario",modelValue:s.usuarioEditar,"onUpdate:modelValue":r[9]||(r[9]=e=>s.usuarioEditar=e),rules:[e=>!!e||"El usuario es obligatorio"],filled:""},{prepend:t(()=>[o(m,{name:"account_circle"})]),_:1},8,["modelValue","rules"])]),l("div",fe,[o(b,{label:"Contrase\xF1a",modelValue:s.contrase\u00F1aEditar,"onUpdate:modelValue":r[10]||(r[10]=e=>s.contrase\u00F1aEditar=e),type:"password",rules:[e=>!!e||"La contrase\xF1a es obligatoria"],filled:""},{prepend:t(()=>[o(m,{name:"vpn_key"})]),_:1},8,["modelValue","rules"])]),l("div",be,[o(w,{label:"Rol",modelValue:s.rolEditar,"onUpdate:modelValue":r[11]||(r[11]=e=>s.rolEditar=e),options:s.rolesDisponibles,rules:[e=>!!e||"El rol es obligatorio"],onInput:i.checkZonaFieldEditar,filled:""},{prepend:t(()=>[o(m,{name:"assignment_ind"})]),_:1},8,["modelValue","options","rules","onInput"])]),s.rolEditar==="Asesor"?(u(),p("div",_e,[o(w,{label:"Zona",modelValue:s.zonaEditar,"onUpdate:modelValue":r[12]||(r[12]=e=>s.zonaEditar=e),options:["Zona 1","Zona 2"],rules:[e=>!!e||"La zona es obligatoria"],filled:""},{prepend:t(()=>[o(m,{name:"place"})]),_:1},8,["modelValue","rules"])])):U("",!0),l("div",Ee,[o(b,{label:"Correo",modelValue:s.emailEditar,"onUpdate:modelValue":r[13]||(r[13]=e=>s.emailEditar=e),rules:[e=>!!e||"El correo es obligatorio"],filled:""},{prepend:t(()=>[o(m,{name:"email"})]),_:1},8,["modelValue","rules"])])]),l("div",ve,[v(o(c,{outline:"",label:"Cancelar",color:"negative",class:"q-mr-sm"},null,512),[[C]]),o(c,{type:"submit",label:"Guardar Cambios",color:"primary",unelevated:"",disable:!i.formValidoEditar},null,8,["disable"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l("div",Ce,[(u(!0),p(A,null,R(s.rolesDisponibles,e=>(u(),p("div",{key:e,class:"role-section q-mb-xl"},[l("div",{class:z(["role-header",`bg-${i.obtenerColorRol(e)}-1`])},[l("div",ye,[o(m,{name:i.obtenerIconoRol(e),size:"md",color:i.obtenerColorRol(e),class:"q-mr-sm"},null,8,["name","color"]),l("div",{class:z(["text-h6 text-weight-medium",`text-${i.obtenerColorRol(e)}`])},h(e),3),o(H,{color:i.obtenerColorRol(e),class:"q-ml-sm"},{default:t(()=>[f(h(i.filtrarUsuariosPorRol(e).length)+" usuarios ",1)]),_:2},1032,["color"])])],2),l("div",Ve,[(u(!0),p(A,null,R(i.filtrarUsuariosPorRol(e),n=>(u(),p("div",{key:n.id,class:"col-xs-12 col-sm-6 col-md-4 col-lg-3"},[o(V,{class:z(["user-card",`bg-${i.obtenerColorRol(e)}-1`])},{default:t(()=>[o(E,{class:"text-center"},{default:t(()=>[o(S,{size:"80px",class:"shadow-5",color:n.imagenPerfil?void 0:i.obtenerColorRol(n.rol),"text-color":"white"},{default:t(()=>[n.imagenPerfil?(u(),p("img",{key:0,src:n.imagenPerfil,alt:"Foto de perfil"},null,8,Ue)):(u(),p(A,{key:1},[f(h(i.getInitials(n.nombreCompleto)),1)],64))]),_:2},1032,["color"]),l("div",we,h(n.nombreCompleto),1),l("div",ke," @"+h(n.usuario),1),o(F,{dense:"",color:i.obtenerColorRol(e),"text-color":"white",class:"q-mt-sm",icon:"badge"},{default:t(()=>[f(h(e),1)]),_:2},1032,["color"]),l("div",xe,h(n.email),1),n.zona?(u(),p("div",qe,[o(F,{dense:"",color:"grey-5","text-color":"white",icon:"place"},{default:t(()=>[f(h(n.zona),1)]),_:2},1024)])):U("",!0)]),_:2},1024),o(Q,{color:`${i.obtenerColorRol(e)}-3`},null,8,["color"]),o(D,{align:"center"},{default:t(()=>[o(c,{flat:"",rounded:"",color:"info",icon:"edit",onClick:B=>i.editarUsuario(n)},{default:t(()=>[o(j,null,{default:t(()=>[f("Editar")]),_:1})]),_:2},1032,["onClick"]),o(c,{flat:"",rounded:"",color:"negative",icon:"delete",onClick:B=>i.confirmarEliminar(n.id)},{default:t(()=>[o(j,null,{default:t(()=>[f("Eliminar")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class"])]))),128)),i.filtrarUsuariosPorRol(e).length===0?(u(),p("div",Ae,[o(X,{class:"bg-grey-2 text-center"},{avatar:t(()=>[o(m,{name:"info",color:"primary"})]),default:t(()=>[f(" No hay usuarios con el rol de "+h(e),1)]),_:2},1024)])):U("",!0)])]))),128))])]),o(q,{modelValue:s.confirmarEliminarDialog,"onUpdate:modelValue":r[15]||(r[15]=e=>s.confirmarEliminarDialog=e),persistent:""},{default:t(()=>[o(V,{class:"confirm-delete-card"},{default:t(()=>[o(E,{class:"row items-center bg-negative text-white"},{default:t(()=>[o(S,{icon:"warning",color:"white","text-color":"negative"}),ze]),_:1}),o(E,{class:"q-pt-md"},{default:t(()=>[f(" \xBFEst\xE1s seguro de que deseas eliminar este usuario? Esta acci\xF3n no se puede deshacer. ")]),_:1}),o(D,{align:"right"},{default:t(()=>[v(o(c,{flat:"",label:"Cancelar",color:"primary"},null,512),[[C]]),v(o(c,{unelevated:"",label:"Eliminar",color:"negative",onClick:i.eliminarUsuarioConfirmado},null,8,["onClick"]),[[C]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Je=W(Y,[["render",Ie],["__scopeId","data-v-486c48a3"]]);export{Je as default};
