import{c as M,E as Z,F as T,a as I,h as C,d as k,g as L,a2 as G,aA as g,a4 as m,a5 as O,a6 as t,au as J,a9 as l,a7 as o,a8 as c,ah as R,aw as y,av as f,N as E,aB as Q,ay as b,ae as d,aC as V,az as p,ax as U,aD as x,aE as S,aF as q,ai as D,ag as _,aG as F,aH as v,aj as A,aa as h,aI as B,ak as H,al as K}from"./index.c27b22cd.js";import{Q as N}from"./QSpace.22f7e2e5.js";import{Q as W}from"./QBadge.5b9e24cb.js";import{Q as P}from"./QTooltip.c446164e.js";var X=M({name:"QBanner",props:{...Z,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(r,{slots:a}){const{proxy:{$q:u}}=L(),z=T(r,u),s=I(()=>"q-banner row items-center"+(r.dense===!0?" q-banner--dense":"")+(z.value===!0?" q-banner--dark q-dark":"")+(r.rounded===!0?" rounded-borders":"")),i=I(()=>`q-banner__actions row items-center justify-end col-${r.inlineActions===!0?"auto":"all"}`);return()=>{const e=[C("div",{class:"q-banner__avatar col-auto row items-center self-start"},k(a.avatar)),C("div",{class:"q-banner__content col text-body2"},k(a.default))],n=k(a.action);return n!==void 0&&e.push(C("div",{class:i.value},n)),C("div",{class:s.value+(r.inlineActions===!1&&n!==void 0?" q-banner--top-padding":""),role:"alert"},e)}}});const Y={data(){return{zona:"",zonaEditar:"",nombreCompleto:"",usuario:"",contrase\u00F1a:"",email:"",usuarios:[],nombreCompletoEditar:"",usuarioEditar:"",rolEditar:"",rol:"",contrase\u00F1aEditar:"",emailEditar:"",usuarioEditandoId:null,confirmarEliminarDialog:!1,usuarioAEliminarId:null,rolesDisponibles:["administrador","Comercial 1","Comercial 2","Contable","Supervisor","Asesor"],coloresRoles:{administrador:"deep-purple","Comercial 1":"teal","Comercial 2":"green",Contable:"blue",Supervisor:"orange",Asesor:"red"},iconosRoles:{administrador:"admin_panel_settings","Comercial 1":"sell","Comercial 2":"add_business",Contable:"account_balance",Supervisor:"supervisor_account",Asesor:"support_agent"},mostrarModalAgregar:!1,mostrarModalEditar:!1}},computed:{formValido(){return this.nombreCompleto&&this.usuario&&this.contrase\u00F1a&&this.rol&&(this.rol!=="Asesor"||this.rol==="Asesor"&&this.zona)&&this.email},formValidoEditar(){return this.nombreCompletoEditar&&this.usuarioEditar&&this.contrase\u00F1aEditar&&this.rolEditar&&(this.rolEditar!=="Asesor"||this.rolEditar==="Asesor"&&this.zonaEditar)&&this.emailEditar}},mounted(){this.cargarUsuarios()},methods:{obtenerColorRol(r){return this.coloresRoles[r]||"grey"},obtenerIconoRol(r){return this.iconosRoles[r]||"person"},filtrarUsuariosPorRol(r){return this.usuarios.filter(a=>a.rol===r)},getInitials(r){return r?r.split(" ").map(a=>a.charAt(0)).join("").toUpperCase().substring(0,2):"?"},confirmarEliminar(r){this.usuarioAEliminarId=r,this.confirmarEliminarDialog=!0},eliminarUsuarioConfirmado(){this.eliminarUsuario(this.usuarioAEliminarId),this.usuarioAEliminarId=null},checkZonaFieldEditar(){this.rolEditar!=="Asesor"&&(this.zonaEditar="")},checkZonaField(){this.rol!=="Asesor"&&(this.zona="")},cargarUsuarios(){fetch("https://backmultidestinos.onrender.com/user/").then(r=>{if(!r.ok)throw new Error("Error en la respuesta del servidor: "+r.status);return r.json()}).then(r=>{this.usuarios=r}).catch(r=>{console.error("Error al cargar usuarios:",r),g.create({type:"negative",message:"Error al cargar usuarios: "+r.message,position:"top",timeout:2500})})},submitForm(){const r="1",a={nombreCompleto:this.nombreCompleto,usuario:this.usuario,contrasena:this.contrase\u00F1a,activo:r,rol:this.rol,zona:this.zona?this.zona:"",email:this.email};fetch("https://backmultidestinos.onrender.com/user/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(u=>{if(!u.ok)throw new Error("Error en la respuesta del servidor: "+u.status);return u.json()}).then(u=>{console.log("Usuario agregado:",u),g.create({type:"positive",message:"Usuario agregado correctamente",position:"top",icon:"check_circle",timeout:2500}),this.cargarUsuarios(),this.limpiarFormulario(),this.mostrarModalAgregar=!1}).catch(u=>{console.error("Error al enviar datos:",u),g.create({type:"negative",message:"Error al agregar usuario: "+u.message,position:"top",timeout:2500})})},editarUsuario(r){this.nombreCompletoEditar=r.nombreCompleto,this.usuarioEditar=r.usuario,this.rolEditar=r.rol,this.usuarioEditandoId=r.id,this.zonaEditar=r.zona||"",this.contrase\u00F1aEditar="",this.emailEditar=r.email||"",this.mostrarModalEditar=!0},editarUsuarioSubmit(){if(!this.formValidoEditar){g.create({type:"warning",message:"Complete todos los campos requeridos",position:"top",timeout:2500});return}const r={id:this.usuarioEditandoId,nombreCompleto:this.nombreCompletoEditar,usuario:this.usuarioEditar,contrasena:this.contrase\u00F1aEditar,rol:this.rolEditar,zona:this.zonaEditar||"",activo:"1",email:this.emailEditar};fetch(`https://backmultidestinos.onrender.com/user/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(a=>{if(!a.ok)throw new Error("Error en la respuesta del servidor: "+a.status);return a.json()}).then(a=>{console.log("Usuario editado:",a),this.cargarUsuarios(),this.limpiarFormularioEditar(),this.mostrarModalEditar=!1,g.create({type:"positive",message:"Usuario editado correctamente",icon:"check_circle",position:"top",timeout:2500})}).catch(a=>{console.error("Error al editar usuario:",a),g.create({type:"negative",message:"Error al editar usuario: "+a.message,position:"top",timeout:2500})})},eliminarUsuario(r){fetch(`https://backmultidestinos.onrender.com/user/${r}`,{method:"DELETE"}).then(a=>{if(!a.ok)throw new Error("Error en la respuesta del servidor: "+a.status);this.usuarios=this.usuarios.filter(u=>u.id!==r),console.log("Usuario eliminado con ID:",r),g.create({type:"positive",message:"Usuario eliminado correctamente",icon:"check_circle",position:"top",timeout:2500})}).catch(a=>{console.error("Error al eliminar usuario:",a),g.create({type:"negative",message:"Error al eliminar usuario: "+a.message,position:"top",timeout:2500})})},limpiarFormulario(){this.nombreCompleto="",this.usuario="",this.contrase\u00F1a="",this.rol="",this.zona="",this.email=""},limpiarFormularioEditar(){this.nombreCompletoEditar="",this.usuarioEditar="",this.contrase\u00F1aEditar="",this.rolEditar="",this.zonaEditar="",this.emailEditar="",this.usuarioEditandoId=null}}},w=r=>(H("data-v-60126792"),r=r(),K(),r),$={class:"container-wrapper q-pa-md"},ee={class:"header-container q-mb-lg"},oe={class:"row items-center justify-between full-width"},ae=w(()=>l("h4",{class:"q-ma-none text-weight-bold text-primary"}," Gesti\xF3n de Usuarios ",-1)),re=w(()=>l("div",{class:"text-h6"},"Agregar Nuevo Usuario",-1)),te={class:"row q-col-gutter-md"},se={class:"col-12"},le={class:"col-12 col-md-6"},ie={class:"col-12 col-md-6"},ne={class:"col-12 col-md-6"},de={key:0,class:"col-12 col-md-6"},ue={class:"col-12 col-md-6"},me={class:"row justify-end q-mt-lg"},ce=w(()=>l("div",{class:"text-h6"},"Editar Usuario",-1)),pe={class:"row q-col-gutter-md"},he={class:"col-12"},ge={class:"col-12 col-md-6"},be={class:"col-12 col-md-6"},_e={class:"col-12 col-md-6"},fe={key:0,class:"col-12 col-md-6"},Ee={class:"col-12 col-md-6"},ve={class:"row justify-end q-mt-lg"},Ce={class:"roles-container"},ye={class:"row items-center q-py-sm q-px-md"},Ve={class:"row q-col-gutter-md q-mt-md q-pa-sm"},Ue=["src"],we={class:"text-h6 q-mt-sm"},ke={class:"text-subtitle2 text-grey-8"},xe={class:"text-subtitle2 text-grey-8"},qe={key:0,class:"q-mt-sm"},Ae={key:0,class:"col-12"},ze=w(()=>l("span",{class:"q-ml-sm text-h6"},"Confirmar eliminaci\xF3n",-1));function Ie(r,a,u,z,s,i){return m(),O(J,{class:"custom-page-bg"},{default:t(()=>[l("div",$,[l("div",ee,[l("div",oe,[ae,o(c,{onClick:a[0]||(a[0]=e=>s.mostrarModalAgregar=!0),label:"Agregar Usuario",class:"add-button",icon:"person_add",color:"primary",unelevated:"",rounded:""})]),o(R,{class:"q-mt-sm",color:"blue-grey-2"})]),o(x,{modelValue:s.mostrarModalAgregar,"onUpdate:modelValue":a[7]||(a[7]=e=>s.mostrarModalAgregar=e),persistent:"","content-css":"max-width: 500px;"},{default:t(()=>[o(y,{class:"modal-card"},{default:t(()=>[o(f,{class:"row items-center bg-primary text-white"},{default:t(()=>[re,o(N),E(o(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[v]])]),_:1}),o(f,{class:"q-pa-md"},{default:t(()=>[o(Q,{onSubmit:i.submitForm},{default:t(()=>[l("div",te,[l("div",se,[o(b,{label:"Nombre completo",modelValue:s.nombreCompleto,"onUpdate:modelValue":a[1]||(a[1]=e=>s.nombreCompleto=e),rules:[e=>!!e||"El nombre completo es obligatorio"],filled:""},{prepend:t(()=>[o(d,{name:"person"})]),_:1},8,["modelValue","rules"])]),l("div",le,[o(b,{label:"Usuario",modelValue:s.usuario,"onUpdate:modelValue":a[2]||(a[2]=e=>s.usuario=e),rules:[e=>!!e||"El usuario es obligatorio"],filled:""},{prepend:t(()=>[o(d,{name:"account_circle"})]),_:1},8,["modelValue","rules"])]),l("div",ie,[o(b,{label:"Contrase\xF1a",modelValue:s.contrase\u00F1a,"onUpdate:modelValue":a[3]||(a[3]=e=>s.contrase\u00F1a=e),type:"password",rules:[e=>!!e||"La contrase\xF1a es obligatoria"],filled:""},{prepend:t(()=>[o(d,{name:"vpn_key"})]),_:1},8,["modelValue","rules"])]),l("div",ne,[o(V,{label:"Rol",modelValue:s.rol,"onUpdate:modelValue":a[4]||(a[4]=e=>s.rol=e),options:s.rolesDisponibles,rules:[e=>!!e||"El rol es obligatorio"],onInput:i.checkZonaField,filled:""},{prepend:t(()=>[o(d,{name:"assignment_ind"})]),_:1},8,["modelValue","options","rules","onInput"])]),s.rol==="Asesor"?(m(),p("div",de,[o(V,{label:"Zona",modelValue:s.zona,"onUpdate:modelValue":a[5]||(a[5]=e=>s.zona=e),options:["Zona 1","Zona 2"],rules:[e=>!!e||"La zona es obligatoria"],filled:""},{prepend:t(()=>[o(d,{name:"place"})]),_:1},8,["modelValue","rules"])])):U("",!0),l("div",ue,[o(b,{label:"Correo",modelValue:s.email,"onUpdate:modelValue":a[6]||(a[6]=e=>s.email=e),rules:[e=>!!e||"El correo es obligatorio"],filled:""},{prepend:t(()=>[o(d,{name:"email"})]),_:1},8,["modelValue","rules"])])]),l("div",me,[E(o(c,{outline:"",label:"Cancelar",color:"negative",class:"q-mr-sm"},null,512),[[v]]),o(c,{type:"submit",label:"Registrar Usuario",color:"primary",disable:!i.formValido,unelevated:""},null,8,["disable"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(x,{modelValue:s.mostrarModalEditar,"onUpdate:modelValue":a[14]||(a[14]=e=>s.mostrarModalEditar=e),persistent:"","content-css":"max-width: 600px;"},{default:t(()=>[o(y,{class:"modal-card"},{default:t(()=>[o(f,{class:"row items-center bg-primary text-white"},{default:t(()=>[ce,o(N),E(o(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[v]])]),_:1}),o(f,{class:"q-pa-md"},{default:t(()=>[o(Q,{onSubmit:i.editarUsuarioSubmit},{default:t(()=>[l("div",pe,[l("div",he,[o(b,{label:"Nombre completo",modelValue:s.nombreCompletoEditar,"onUpdate:modelValue":a[8]||(a[8]=e=>s.nombreCompletoEditar=e),rules:[e=>!!e||"El nombre completo es obligatorio"],filled:""},{prepend:t(()=>[o(d,{name:"person"})]),_:1},8,["modelValue","rules"])]),l("div",ge,[o(b,{label:"Usuario",modelValue:s.usuarioEditar,"onUpdate:modelValue":a[9]||(a[9]=e=>s.usuarioEditar=e),rules:[e=>!!e||"El usuario es obligatorio"],filled:""},{prepend:t(()=>[o(d,{name:"account_circle"})]),_:1},8,["modelValue","rules"])]),l("div",be,[o(b,{label:"Contrase\xF1a",modelValue:s.contrase\u00F1aEditar,"onUpdate:modelValue":a[10]||(a[10]=e=>s.contrase\u00F1aEditar=e),type:"password",rules:[e=>!!e||"La contrase\xF1a es obligatoria"],filled:""},{prepend:t(()=>[o(d,{name:"vpn_key"})]),_:1},8,["modelValue","rules"])]),l("div",_e,[o(V,{label:"Rol",modelValue:s.rolEditar,"onUpdate:modelValue":a[11]||(a[11]=e=>s.rolEditar=e),options:s.rolesDisponibles,rules:[e=>!!e||"El rol es obligatorio"],onInput:i.checkZonaFieldEditar,filled:""},{prepend:t(()=>[o(d,{name:"assignment_ind"})]),_:1},8,["modelValue","options","rules","onInput"])]),s.rolEditar==="Asesor"?(m(),p("div",fe,[o(V,{label:"Zona",modelValue:s.zonaEditar,"onUpdate:modelValue":a[12]||(a[12]=e=>s.zonaEditar=e),options:["Zona 1","Zona 2"],rules:[e=>!!e||"La zona es obligatoria"],filled:""},{prepend:t(()=>[o(d,{name:"place"})]),_:1},8,["modelValue","rules"])])):U("",!0),l("div",Ee,[o(b,{label:"Correo",modelValue:s.emailEditar,"onUpdate:modelValue":a[13]||(a[13]=e=>s.emailEditar=e),rules:[e=>!!e||"El correo es obligatorio"],filled:""},{prepend:t(()=>[o(d,{name:"email"})]),_:1},8,["modelValue","rules"])])]),l("div",ve,[E(o(c,{outline:"",label:"Cancelar",color:"negative",class:"q-mr-sm"},null,512),[[v]]),o(c,{type:"submit",label:"Guardar Cambios",color:"primary",unelevated:"",disable:!i.formValidoEditar},null,8,["disable"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l("div",Ce,[(m(!0),p(q,null,S(s.rolesDisponibles,e=>(m(),p("div",{key:e,class:"role-section q-mb-xl"},[l("div",{class:A(["role-header",`bg-${i.obtenerColorRol(e)}-1`])},[l("div",ye,[o(d,{name:i.obtenerIconoRol(e),size:"md",color:i.obtenerColorRol(e),class:"q-mr-sm"},null,8,["name","color"]),l("div",{class:A(["text-h6 text-weight-medium",`text-${i.obtenerColorRol(e)}`])},h(e),3),o(W,{color:i.obtenerColorRol(e),class:"q-ml-sm"},{default:t(()=>[_(h(i.filtrarUsuariosPorRol(e).length)+" usuarios ",1)]),_:2},1032,["color"])])],2),l("div",Ve,[(m(!0),p(q,null,S(i.filtrarUsuariosPorRol(e),n=>(m(),p("div",{key:n.id,class:"col-xs-12 col-sm-6 col-md-4 col-lg-3"},[o(y,{class:A(["user-card",`bg-${i.obtenerColorRol(e)}-1`])},{default:t(()=>[o(f,{class:"text-center"},{default:t(()=>[o(D,{size:"80px",class:"shadow-5",color:n.imagenPerfil?void 0:i.obtenerColorRol(n.rol),"text-color":"white"},{default:t(()=>[n.imagenPerfil?(m(),p("img",{key:0,src:n.imagenPerfil,alt:"Foto de perfil"},null,8,Ue)):(m(),p(q,{key:1},[_(h(i.getInitials(n.nombreCompleto)),1)],64))]),_:2},1032,["color"]),l("div",we,h(n.nombreCompleto),1),l("div",ke," @"+h(n.usuario),1),o(B,{dense:"",color:i.obtenerColorRol(e),"text-color":"white",class:"q-mt-sm",icon:"badge"},{default:t(()=>[_(h(e),1)]),_:2},1032,["color"]),l("div",xe,h(n.email),1),n.zona?(m(),p("div",qe,[o(B,{dense:"",color:"grey-5","text-color":"white",icon:"place"},{default:t(()=>[_(h(n.zona),1)]),_:2},1024)])):U("",!0)]),_:2},1024),o(R,{color:`${i.obtenerColorRol(e)}-3`},null,8,["color"]),o(F,{align:"center"},{default:t(()=>[o(c,{flat:"",rounded:"",color:"info",icon:"edit",onClick:j=>i.editarUsuario(n)},{default:t(()=>[o(P,null,{default:t(()=>[_("Editar")]),_:1})]),_:2},1032,["onClick"]),o(c,{flat:"",rounded:"",color:"negative",icon:"delete",onClick:j=>i.confirmarEliminar(n.id)},{default:t(()=>[o(P,null,{default:t(()=>[_("Eliminar")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class"])]))),128)),i.filtrarUsuariosPorRol(e).length===0?(m(),p("div",Ae,[o(X,{class:"bg-grey-2 text-center"},{avatar:t(()=>[o(d,{name:"info",color:"primary"})]),default:t(()=>[_(" No hay usuarios con el rol de "+h(e),1)]),_:2},1024)])):U("",!0)])]))),128))])]),o(x,{modelValue:s.confirmarEliminarDialog,"onUpdate:modelValue":a[15]||(a[15]=e=>s.confirmarEliminarDialog=e),persistent:""},{default:t(()=>[o(y,{class:"confirm-delete-card"},{default:t(()=>[o(f,{class:"row items-center bg-negative text-white"},{default:t(()=>[o(D,{icon:"warning",color:"white","text-color":"negative"}),ze]),_:1}),o(f,{class:"q-pt-md"},{default:t(()=>[_(" \xBFEst\xE1s seguro de que deseas eliminar este usuario? Esta acci\xF3n no se puede deshacer. ")]),_:1}),o(F,{align:"right"},{default:t(()=>[E(o(c,{flat:"",label:"Cancelar",color:"primary"},null,512),[[v]]),E(o(c,{unelevated:"",label:"Eliminar",color:"negative",onClick:i.eliminarUsuarioConfirmado},null,8,["onClick"]),[[v]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Fe=G(Y,[["render",Ie],["__scopeId","data-v-60126792"]]);export{Fe as default};
